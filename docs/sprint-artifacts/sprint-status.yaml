# generated: 2025-11-22
# project: ndx
# project_key: ndx
# tracking_system: file-system
# story_location: /Users/cns/httpdocs/cddo/ndx/docs/sprint-artifacts

# STATUS DEFINITIONS:
# ==================
# Epic Status:
#   - backlog: Epic exists in epic file but not contexted
#   - contexted: Epic tech context created (required before drafting stories)
#
# Story Status:
#   - backlog: Story only exists in epic file
#   - drafted: Story file created in stories folder
#   - ready-for-dev: Draft approved and story context created
#   - in-progress: Developer actively working on implementation
#   - review: Under SM review (via code-review workflow)
#   - done: Story completed
#
# Retrospective Status:
#   - optional: Can be completed but not required
#   - completed: Retrospective has been done
#
# WORKFLOW NOTES:
# ===============
# - Epics should be 'contexted' before stories can be 'drafted'
# - Stories can be worked in parallel if team capacity allows
# - SM typically drafts next story after previous one is 'done' to incorporate learnings
# - Dev moves story to 'review', SM reviews, then Dev moves to 'done'

generated: 2025-11-22
project: ndx
project_key: ndx
tracking_system: file-system
story_location: /Users/cns/httpdocs/cddo/ndx/docs/sprint-artifacts

# Workflow Status
workflow_status:
  prd: /Users/cns/httpdocs/cddo/ndx/docs/prd.md
  architecture: /Users/cns/httpdocs/cddo/ndx/docs/architecture.md
  epics: /Users/cns/httpdocs/cddo/ndx/docs/epics.md

development_status:
  # Epic 1: CloudFront Origin Infrastructure (COMPLETED)
  epic-1: done
  1-1-import-existing-cloudfront-distribution-in-cdk: done
  1-2-add-new-s3-origin-with-origin-access-control: done
  1-3-verify-existing-origins-remain-unchanged: done
  1-4-deploy-cloudfront-infrastructure-changes-to-aws: done
  epic-1-retrospective: optional

  # Epic 2: Cookie-Based Routing Implementation (COMPLETED)
  epic-2: done
  2-1-create-cloudfront-function-for-cookie-inspection: done
  2-2-write-unit-tests-for-cookie-router-function: done
  2-3-configure-cache-policy-with-ndx-cookie-allowlist: done
  2-4-deploy-cloudfront-function-to-cdk-stack: done
  2-5-attach-function-to-default-cache-behavior: done
  2-6-deploy-routing-functionality-and-validate: done
  epic-2-retrospective: optional

  # Epic 3: Testing, Validation & Operational Readiness (COMPLETED)
  epic-3: done
  3-1-write-cdk-snapshot-tests-for-cloudfront-configuration: done
  3-2-write-fine-grained-assertion-tests-for-critical-properties: done
  3-3-create-integration-test-for-real-aws-deployment: done
  3-4-document-rollback-procedures: done
  3-5-update-infrastructure-readme-with-operations-guide: done
  3-6-create-pre-deployment-checklist-and-validation-script: done
  epic-3-retrospective: optional

  # Epic 4: Local Development Infrastructure (Feature 2 - Try Before You Buy)
  epic-4: contexted
  4-1-mitmproxy-setup-documentation: done
  4-2-create-mitmproxy-addon-script-for-conditional-forwarding: done
  4-3-mitmproxy-run-configuration: done
  4-4-system-proxy-configuration-instructions: done
  4-5-certificate-trust-setup-https-interception: done
  4-6-setup-validation-script: done
  epic-4-retrospective: optional

  # Epic 5: Authentication Foundation (COMPLETED)
  epic-5: done
  5-1-sign-in-out-button-ui-components: done
  5-2-sign-in-oauth-redirect-flow: done
  5-3-jwt-token-extraction-from-url: done
  5-4-sessionstorage-jwt-persistence: done
  5-5-sign-out-functionality: done
  5-6-api-authorization-header-injection: done
  5-7-authentication-status-check-api: done  # Code review complete (2025-11-25): All ACs implemented, 45 tests passing, APPROVED
  5-8-401-unauthorized-response-handling: done  # Code review complete (2025-11-25): All ACs implemented, 45 tests passing, APPROVED
  5-9-empty-state-ui-for-unauthenticated-try-page: done  # Code review complete (2025-11-25): All ACs implemented, 23 tests passing, APPROVED
  5-10-automated-accessibility-tests-for-auth-ui: done  # Code review complete (2025-11-25): All ACs implemented, 12 tests passing, APPROVED
  5-11-authentication-e2e-test-suite: done  # Code review complete (2025-11-25): 23/24 tests passing, 1 skipped (documented), APPROVED
  epic-5-retrospective: optional

  # Epic 6: Catalogue Integration & Sandbox Requests (COMPLETED)
  epic-6: done
  6-0-ux-review-checkpoint-gate: done
  6-1-parse-try-metadata-from-product-yaml-frontmatter: done
  6-2-generate-try-before-you-buy-tag-system: done
  6-3-catalogue-tag-filter-for-try-before-you-buy: done
  6-4-try-this-now-for-24-hours-button-on-product-pages: done
  6-5-try-button-authentication-check: done  # Code review complete (2025-11-25): All ACs implemented, 22 tests passing, APPROVED
  6-6-lease-request-modal-overlay-ui: done
  6-7-fetch-and-display-aup-from-innovation-sandbox-api: done
  6-8-aup-checkbox-and-continue-button-state: done
  6-9-submit-lease-request-and-handle-responses: done
  6-10-epic-6-7-integration-testing: done
  6-11-automated-accessibility-tests-for-catalogue-try-ui: done  # Code review complete (2025-11-25): 19/19 tests passing, WCAG violations fixed, APPROVED
  epic-6-retrospective: optional

  # Epic 7: Try Sessions Dashboard (COMPLETED)
  epic-7: done
  7-1-create-try-page-route-and-layout: done
  7-2-fetch-and-display-user-leases: done
  7-3-render-sessions-table-with-govuk-design-system: done
  7-4-status-badge-display-with-color-coding: done
  7-5-expiry-date-formatting-relative-and-absolute: done
  7-6-budget-display-with-cost-formatting: done  # Code review complete (2025-11-25): All ACs implemented, ARIA + CSS fixes, 396 tests passing, APPROVED
  7-7-launch-aws-console-button-for-active-sessions: done  # Code review complete (2025-11-25): All 6 ACs implemented, 43 tests passing, APPROVED
  7-8-remaining-lease-duration-display-for-active-sessions: done  # Implemented as part of 7-2, formatRemainingTime in date-utils.ts
  7-9-link-to-catalogue-filter-from-try-page: done
  7-10-first-time-user-guidance-on-try-page: done  # Implemented as renderFirstTimeGuidance() in try-page.ts:215
  7-11-aws-sso-portal-url-configuration: done
  7-12-end-to-end-user-journey-validation: done  # Code review complete (2025-11-25): All ACs implemented, E2E test fix applied, 20/20 tests passing, APPROVED
  7-13-automated-accessibility-tests-for-dashboard-ui: done
  epic-7-retrospective: optional

  # Epic 8: Accessible & Mobile-Friendly Experience + Brownfield Audit (COMPLETED)
  epic-8: done
  8-0-e2e-testing-infrastructure-setup-playwright-ci: done  # Code review complete (2025-11-25): Playwright config + CI workflows setup, 146/147 tests passing, APPROVED
  8-1-early-brownfield-accessibility-audit-parallel-with-epic-4: done
  8-2-automated-accessibility-testing-in-ci-pipeline: done  # Code review complete (2025-11-25): CI workflows + pa11y/lighthouse configs present, automated tests in pipeline, APPROVED
  8-3-comprehensive-wcag-22-audit-for-try-feature-ui: done  # Code review complete (2025-11-25): WCAG compliance report completed, all 50 AA criteria pass, APPROVED
  8-4-govuk-design-system-component-compliance-audit: done  # Code review complete (2025-11-25): GOV.UK component audit completed, all components compliant, APPROVED
  8-5-mobile-responsive-design-validation: done  # Code review complete (2025-11-25): Responsive design validation completed, mobile breakpoints tested, APPROVED
  8-6-performance-and-security-validation: done  # Code review complete (2025-11-25): Performance & security audit completed, Lighthouse/OWASP tests passing, APPROVED
  8-7-keyboard-navigation-testing: done  # Code review complete (2025-11-25): E2E keyboard navigation tests passing (26 tests), all flows keyboard accessible, APPROVED
  8-8-screen-reader-testing-nvda-jaws-voiceover: done  # Code review complete (2025-11-25): Screen reader testing documented in WCAG compliance report, ARIA labels validated, APPROVED
  8-9-focus-management-and-visual-focus-indicators: done  # Code review complete (2025-11-25): E2E focus management tests passing (14 tests), GOV.UK focus indicators validated, APPROVED
  8-10-error-messaging-accessibility: done  # Code review complete (2025-11-25): E2E error messaging tests passing (13 tests), 2 tests fixed for sensitive info exposure, APPROVED
  8-11-wcag-22-aa-compliance-certification: done  # Code review complete (2025-11-25): Accessibility statement published, all documentation complete, WCAG 2.2 AA certified, APPROVED
  epic-8-retrospective: optional

# ============================================================
# REGRESSION FIX SUMMARY (2025-11-24)
# ============================================================
# Problem: govukEleventyPlugin header template overriding custom header
# - Custom header at src/_includes/components/header/template.njk NOT being used
# - Built HTML had NO #auth-nav element
# - Try page <main> content was empty (no #try-sessions-container)
#
# Solution Applied:
# 1. Added #auth-nav via serviceNavigation.slots.end in eleventy.config.js
# 2. Created custom try-page.njk layout for Try page content
# 3. Updated auth-nav.ts to use govuk-service-navigation__link class
# 4. Updated src/try/index.md to use the custom layout
#
# Files Modified:
# - eleventy.config.js (line 114-116): Added slots.end with auth-nav span
# - src/_includes/layouts/try-page.njk (NEW): Custom layout for try page
# - src/try/index.md: Changed layout to layouts/try-page.njk
# - src/try/ui/auth-nav.ts: Updated CSS classes for service navigation
#
# Test Results After Fix:
# - E2E Auth Tests: 22/24 passing (2 redirect timeout flakes)
# - #auth-nav element present in all pages
# - #try-sessions-container renders correctly on /try page
# ============================================================
